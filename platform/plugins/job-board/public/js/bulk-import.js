(()=>{function e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,a,i,s=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(o=a.call(n)).done)&&(s.push(o.value),s.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw r}}return s}}(e,t)||o(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||o(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){if(e){if("string"==typeof e)return r(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}$(function(){var o=$(document).find("#bulk-import"),r=o.find(".form-import-data"),a=o.find(".btn-import"),i=[],s=0;$(document).on("click",".btn-import",function(e){e.preventDefault(),u.getQueuedFiles().length>0&&(Botble.showButtonLoading(a),o.find(".show-errors").hide(),s=0,i=[],u.processQueue()),u.on("sending",function(){o.find(".bulk-import-message").removeClass("alert-success").addClass("alert-info").text(a.data("uploading-text")).show()}),u.on("error",function(e,t){Botble.showError(t.message)})});var l=function(f){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;0===d&&o.find(".bulk-import-message").text(a.data("validating-text")),$httpClient.make().post(r.data("validate-url"),{file:f,offset:d,limit:m,update_existing:$("#update-existing").is(":checked")?1:0}).then(function(r){var d=r.data,m=d.data,p=d.message;if(m&&m.failed&&Object.keys(m.failed).length>0){i=[].concat(n(i),n(m.failed)),s+=m.count;var h=o.find("#imported-listing"),y=o.find(".show-errors"),b=$(document).find("#failure-template").html(),g="";i.forEach(function(n,o){var r=void 0!==n.row?n.row:o+1,a=[];Array.isArray(n.errors)?a=n.errors:"object"===t(n.errors)&&null!==n.errors&&Object.entries(n.errors).forEach(function(t){var n=e(t,2),o=n[0],r=n[1];Array.isArray(r)?r.forEach(function(e){a.push("".concat(o,": ").concat(e))}):"string"==typeof r&&a.push("".concat(o,": ").concat(r))}),0===a.length&&"object"===t(n)&&null!==n&&Object.entries(n).forEach(function(t){var n=e(t,2),o=n[0],r=n[1];"row"!==o&&Array.isArray(r)?r.forEach(function(e){a.push("".concat(o,": ").concat(e))}):"row"!==o&&"string"==typeof r&&a.push("".concat(o,": ").concat(r))}),g+=b.replace("__row__",r).replace("__errors__",a.join(", "))}),y.show(),o.find(".main-form-message").show(),h.show().html(g),i=[],s=0,Botble.hideButtonLoading(a),u.removeAllFiles(),o.find(".bulk-import-message").hide()}else m&&m.count>0?(o.find(".bulk-import-message").show(),o.find(".bulk-import-message").text(p),l(f,m.offset),i=[].concat(n(i),n(m.failed)),s+=m.count):c(f)})},c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;0===t&&(o.find(".bulk-import-message").text(a.data("importing-text")),Botble.showButtonLoading(a)),$httpClient.make().post(r.data("import-url"),{file:e,offset:t,limit:n,update_existing:$("#update-existing").is(":checked")?1:0}).then(function(t){var n=t.data,r=n.data,i=n.message,l=o.find(".processing"),f=l.find(".process");r&&r.count>0?(l.show(),c(e,r.offset),f.css("width",r.offset/s*100+"%"),o.find(".bulk-import-message").html(i)):(Botble.showSuccess(i),r.total_message&&(o.find(".main-form-message").show(),o.find(".bulk-import-message").removeClass("alert-info").addClass("alert-success").text(r.total_message).show(),u.removeAllFiles(),l.hide(),s=0,Botble.hideButtonLoading(a)))})},u=new Dropzone(".import-dropzone",{url:r.data("upload-url"),method:"post",headers:{"X-CSRF-TOKEN":r.find("input[name=_token]").val()},previewTemplate:$(document).find("#preview-template").html(),autoProcessQueue:!1,chunking:!0,chunkSize:1048576,acceptedFiles:$(".import-dropzone").data("mimetypes"),maxFiles:1,maxfilesexceeded:function(e){this.removeFile(e)},success:function(e,t){var n=t.data;t.message;n&&n.file_path&&l(n.file_path)}}),f=!1;$(document).on("click",".download-template",function(e){if(e.preventDefault(),!f){var t=$(e.currentTarget),n=t.data("extension"),o=t.html();t.html(t.data("downloading")),t.addClass("text-secondary"),f=!0,$httpClient.make().withResponseType("blob").post(t.data("url"),{extension:n}).then(function(e){var n=e.data,o=document.createElement("a"),r=window.URL.createObjectURL(n);o.href=r,o.download=t.data("filename"),document.body.append(o),o.click(),o.remove(),window.URL.revokeObjectURL(r)}).finally(function(){setTimeout(function(){t.html(o),t.removeClass("text-secondary"),f=!1},2e3)})}})})})();